!function(e){function t(i){if(a[i])return a[i].exports;var r=a[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var a={};t.m=e,t.c=a,t.d=function(e,a,i){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=29)}({0:function(e,t){e.exports=window.$},1:function(e,t){(function(t){e.exports=t}).call(t,{})},29:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a.n(i);window.$=r.a,function(e){"function"==typeof define&&a(1)?define(["jquery"],e):e(jQuery)}(function(e){var t={btnName:"上传文件",swf:baseUrl+"/js/vendor/webuploader/Uploader.swf",server:FileUpdateUrl+"/sword?SwordControllerName=fileUploadChunkController",resize:!1,nameFields:{id:"attachmentId",name:"attachmentName",path:"attachmentPath",format:"format",type:"fileType",md5:"attachmentMd5"},multiple:!0,chunked:!0,fileDatas:[],onSuccess:null,isManage:!1,accept:{extensions:"gif,jpg,jpeg,bmp,png,tiff,doc,docx,xls,xlsx,ppt,pptx,pdf,mp4,flv,avi,wmv,rmvb,mov,mpg,wma,mp3,wav,zip,rar,7z",mimeTypes:"image/*,application/vnd.ms-excel.12,application/vnd.ms-word.document.12,application/vnd.ms-powerpoint.12,application/pdf,application/vnd.ms-excel,application/vnd.ms-powerpoint,application/msword,video/*,application/vnd.rn-realmedia-vbr,audio/*,application/zip,application/x-rar-compressed,application/x-7z-compressed",title:"全部文件"},fileSingleSizeLimit:null,auto:!0,fileServer:URL_FILE_SERVER||"/"};e.fn.larUploadMulti=function(t){return a[t]?a[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("MultiMethods "+t+" does not exist on jQuery.larUploadMulti"):a.init.apply(this,arguments)};var a={init:function(i){var r=e.extend({},t,i);return this.each(function(){var t=e(this);t.data("larUploadMulti")||e(this).data("larUploadMulti",{target:t,options:r}),t=a._renderUI(t,r),t=a._addEvent(t),r.pick=t.find(".multi-upload .choose-file")[0],t.data("options",r),a._loadUploader(t,r),r.fileDatas.length&&(t.$table.show(),e.each(r.fileDatas,function(e,i){a._addTr(t,i,"U")}))})},getData:function(t){var a=e(this);t?e.isArray(t)||(t=[t]):t=["I","U","D"];var i=[];return a.find("table tbody tr").each(function(){var a=e(this).data("userFile");e.inArray(a.status,t)>=0&&i.push(a)}),i},setData:function(t){var i=e(this);t&&t.length&&(i.find("table").show(),e.each(t,function(e,t){a._addTr(i,t,"U")}))},_addEvent:function(t){return t.off("click",".multi-upload .file-list table tbody tr td .glyphicon-trash"),t.on("click",".multi-upload .file-list table tbody tr td .glyphicon-trash",function(a){var i=e(this).parents("tr"),r=i.data("userFile"),l=i.data("uploaderFile");r&&"U"===r.status?(i.hide(),r.status="D"):(l&&t.uploader.removeFile(l),i.remove())}),t},_renderUI:function(t,a){var i=[],r=a;return t.empty(),t.addClass("lar-upload-multi"),i.push('<div  class="multi-upload input-group">'),i.push('\t<div class="choose-file">'),i.push('\t\t<button type="button" class="btn btn-default" style="margin-top:0">'+r.btnName+"</button>"),i.push("\t</div>"),i.push('\t<div class="file-list">'),i.push('\t\t<table class="table table-bordered" style="display:none">'),i.push("\t\t\t<thead>"),i.push("\t\t\t\t<tr>"),i.push('\t\t\t\t\t<td name="fileName">文件名称</td>'),i.push('\t\t\t\t\t<td name="operation">操作</td>'),i.push("\t\t\t\t</tr>"),i.push("\t\t\t</thead>"),i.push("\t\t\t<tbody>"),i.push("\t\t\t</tbody>"),i.push("\t\t</table>"),i.push("\t</div"),i.push("</div>"),t.append(i.join("")),t.$upload=e(".multi-upload",t),t.$chooseFile=e(".multi-upload .choose-file button",t),t.$table=e(".multi-upload .file-list table",t),t.$fileList=e(".multi-upload .file-list table tbody tr",t),t},_addTr:function(t,a,i){var r=[],l=t.data("options");r.push("<tr>"),r.push('\t<td name="fileName">'),r.push("\t</td>"),r.push('\t<td name="operation">'),r.push("\t</td>"),r.push("</tr>");var n=e(r.join(""));t.find(".file-list table").show(),t.find(".file-list table tbody").append(n);var o=a.name,s=a.path;a.id;"U"===i&&(o=a[l.nameFields.name],s=a[l.nameFields.path],a[l.nameFields.id]);var d=e('<div class="file-name"><span>'+o+"</span></div>");n.find("td[name=fileName]").append(d);var p=e('<div class="file-progress"><div class="progress progress-striped active"><div class="progress-bar" role="progressbar" style="width: 0%"></div></div></div>');n.find("td[name=fileName]").append(p),"U"===i?(p.hide(),d.find("span").wrap('<a target="_blank" href="'+l.fileServer+s+'"></div>'),a.status=a.status||"U",n.data("userFile",a)):(n.attr("id","row_"+a.id),n.data("uploaderFile",a)),n.find("td[name=operation]").append('<i class="glyphicon glyphicon-trash" style="cursor:pointer" title="删除"></i>')},_translateFile:function(e,t){var a=e.data("options"),i={};return i.status="I",i[a.nameFields.name]=t.name,i[a.nameFields.id]=t.larFileId,i[a.nameFields.path]=t.larFilePath,i[a.nameFields.format]=t.ext,i[a.nameFields.md5]=t.larFileMd5,i[a.nameFields.type]=t.type,i},_loadUploader:function(e,t){var i=this,r=t;r.chunked&&a._register(e),e.uploader=WebUploader.create(t),e.data("uploader",e.uploader),e.uploader.on("fileQueued",function(t){i._addTr(e,t),t.larProgress=e.find(".file-progress .progress-bar")}),e.uploader.on("uploadBeforeSend",function(e,t,a){t.chunkSize=this.options.chunkSize,t.md5=e.file.larFileMd5,t.filePath=e.file.larFilePath}),e.uploader.on("uploadStart",function(e){}),e.uploader.on("uploadProgress",function(t,a){e.find("#row_"+t.id).find(".progress-bar").css("width",Math.floor(100*a)+"%").html(Math.floor(100*a)+"%")}),e.uploader.on("uploadSuccess",function(t){var a=e.find("#row_"+t.id),l=i._translateFile(e,t);a.find(".file-progress").hide(),a.find(".file-name span").wrap('<a target="_blank" href="'+r.fileServer+t.larFilePath+'"></div>'),a.data("userFile",l),r.onSuccess&&r.onSuccess()}),e.uploader.on("uploadError",function(e){console.log("error")}),e.uploader.on("error",function(e){if("F_EXCEED_SIZE"===e&&this.options.fileSingleSizeLimit){var t=this.options.fileSingleSizeLimit/1024/1024+"M";layer.alert("文件大小超过"+t+",不能上传",{title:"温馨提示："})}if("Q_TYPE_DENIED"===e&&this.options.accept.length>0&&this.options.accept[0].extensions){var a=this.options.accept[0].extensions;layer.alert("文件格式不是"+a+",不能上传",{title:"温馨提示："})}"F_DUPLICATE"===e&&layer.alert("不要重复上传",{title:"温馨提示："})})},_unRegister:function(){WebUploader.Uploader.unRegister("beforeSendFile"),WebUploader.Uploader.unRegister("beforeSend"),WebUploader.Uploader.unRegister("afterSendFile")},_register:function(t){a._unRegister();var i=null;WebUploader.Uploader.register({name:"beforeSendFile","before-send-file":function(t){var a=WebUploader.Deferred(),r=((new Date).getTime(),this.owner);return r.md5File(t.source).progress(function(e){t.larProgress.css("width",Math.floor(100*e)+"%").html("MD5  "+Math.floor(100*e)+"%")}).fail(function(){a.reject()}).then(function(l){e.ajax({type:"POST",url:FileUpdateUrl+"/sword/fileUpload/beforeSendFile",dataType:"json",autoWrap:!1,data:{md5:l,fileFullName:t.name,fileMiddleDir:r.options.fileMiddleDir,fileSize:t.size,isManage:r.options.isManage,isSearchFlag:!0},success:function(e){"noConfig"===e.model.status?(layer.alert("未找到附件配置，中断上传.",{title:"温馨提示："}),a.reject()):(t.larFileMd5=l,t.larFileId=e.model.data.id,t.larFilePath=e.model.data.filePath,"completed"===e.model.status?r.skipFile(t):i=e.model.data,a.resolve())}})}),a.promise()}}),WebUploader.Uploader.register({name:"beforeSend","before-send":function(t){var a=WebUploader.Deferred();return i.chunks?!function(){return e(i.chunks).each(function(e,a){if(a.chunk===t.chunk)return!0}),!1}()?a.resolve():a.reject():a.resolve(),a.promise()}}),WebUploader.Uploader.register({name:"afterSendFile","after-send-file":function(t){e.ajax({type:"POST",url:FileUpdateUrl+"/sword/fileUpload/afterSendFile",dataType:"json",autoWrap:!1,data:{id:t.larFileId},success:function(e){e.model.success}})}})}}})}});