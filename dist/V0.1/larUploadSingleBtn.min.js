!function(e){function i(o){if(n[o])return n[o].exports;var l=n[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,i),l.l=!0,l.exports}var n={};i.m=e,i.c=n,i.d=function(e,n,o){i.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},i.p="",i(i.s=30)}({0:function(e,i){e.exports=window.$},1:function(e,i){(function(i){e.exports=i}).call(i,{})},30:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(0),l=n.n(o);window.$=l.a,function(e){"function"==typeof define&&n(1)?define(["jquery"],e):e(jQuery)}(function(e){var i={swf:baseUrl+"/js/vendor/webuploader/Uploader.swf",server:FileUpdateUrl+"/sword?SwordControllerName=fileUploadChunkController",resize:!1,nameFields:{id:"fileId",name:"fileName",path:"filePath"},multiple:!0,chunked:!0,fileDatas:[],onSuccess:null,isManage:!1,accept:{extensions:"gif,jpg,jpeg,bmp,png,tiff,doc,docx,xls,xlsx,ppt,pptx,pdf,mp4,flv,avi,wmv,rmvb,mov,mpg,wma,mp3,wav,zip,rar,7z",mimeTypes:"image/*,application/vnd.ms-excel.12,application/vnd.ms-word.document.12,application/vnd.ms-powerpoint.12,application/pdf,application/vnd.ms-excel,application/vnd.ms-powerpoint,application/msword,video/*,application/vnd.rn-realmedia-vbr,audio/*,application/zip,application/x-rar-compressed,application/x-7z-compressed",title:"全部文件"},fileSingleSizeLimit:null};e.fn.larUploadSingle=function(i){return n[i]?n[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void e.error("SingleMethods "+i+" does not exist on jQuery.larUploadSingle"):n.init.apply(this,arguments)};var n={init:function(o){var l=e.extend({},i,o);return this.each(function(){var i=e(this),o=i.data("larUploadSingle");console.log(o),o||e(this).data("larUploadSingle",{target:i,options:l}),i=n._renderUI(i,l),l.pick=i.find(".single-upload .choose-file")[0],n._loadUploader(i,l)})},getVal:function(){var i=e(this),n={};return i.find(".single-oper input").each(function(e,i){n[i.name]=i.value}),n},_renderUI:function(i,n){var o=[];return i.addClass("lar-upload-single"),o.push('<div  class="single-upload input-group">                                                            '),o.push('\t<div class="choose-file">                                                          '),o.push('\t\t<button type="button" class="btn btn-default" style="margin-top:0">上传图片</button>                                       '),o.push("\t</div>                                                                                "),o.push('\t<div class="file-info"></div>                                                           '),o.push("</div>                                                                                   "),i.append(o.join("")),i.$upload=e(".single-upload",i),i.$chooseFile=e(".single-upload .choose-file",i),i},_removeServerFile:function(i){console.log("remove server file"),e.post(FileUpdateUrl+"/sword/fileUpload/delFile",{larFileId:i.larFileId})},_addTr:function(i,n){var o=(this.options,e('<div class="fileNumber'+i.index+'"></div>')),l=e('<div class="single-progress" id="progress'+n.id+'"><div class="progress progress-striped active"><div class="progress-bar" role="progressbar" style="width: 0%"></div></div></div>'),r=e('<div class="single-oper" style="margin-top: 5px;"><div style="display: inline-block;margin-right: 10px;width: 86%;" class="fileName"><input type="hidden" class="fields-id" id="attachmentId'+i.index+'" name="attachmentId'+i.index+'" /><input type="hidden" class="fields-name" id="name'+i.index+'" name="name'+i.index+'" value="'+n.name+'"/><input type="hidden" class="fields-path" id="path'+i.index+'" name="path'+i.index+'" /><div class="fields-name" style="width: 100%;overflow: hidden; white-space: nowwrap; text-overflow: ellipsis">'+n.name+'</div></div><i class="glyphicon glyphicon-remove" style="cursor:pointer" id="fileNumber'+i.index+'" title="删除"></i></div>');i.index++,l.hide(),r.hide(),o.append(l),o.append(r),i.append(o),i.$remove=e(".single-oper .glyphicon-remove",i),i.$remove.click(function(){e(".lar-upload-single").find("."+e(this).attr("id")).empty()})},_loadUploader:function(e,i){var o=this,l=i;e.index=0,e.indexSuccess=0,l.chunked&&n._register(e),e.uploader=WebUploader.create(i),e.uploader.on("fileQueued",function(i){e.$chooseFile.find("button")[0].value=i.name,o._addTr(e,i),i.larProgress=e.find(".single-progress").find('div[class="progress-bar"]')}),e.uploader.on("uploadBeforeSend",function(e,i,n){i.chunkSize=this.options.chunkSize,i.md5=e.file.larFileMd5,i.filePath=e.file.larFilePath}),e.uploader.on("uploadStart",function(i){e.uploader.upload(),e.find("#progress"+i.id).show()}),e.uploader.on("uploadProgress",function(i,n){e.find("#progress"+i.id).find(".progress-bar").css("width",Math.floor(100*n)+"%").html(Math.floor(100*n)+"%")}),e.uploader.on("uploadSuccess",function(i){e.find(".single-progress").hide(),e.find(".single-oper").show(),e.uploader.options.fileDatas.push({fileId:i.larFileId,fileName:i.name,filePath:i.larFilePath}),e.find(".single-oper").find("#attachmentId"+e.indexSuccess).val(i.larFileId),e.find(".single-oper").find("#path"+e.indexSuccess).val(i.larFilePath),e.indexSuccess++,l.onSuccess&&l.onSuccess()}),e.uploader.on("uploadError",function(e){console.log("error")}),e.uploader.on("error",function(e){if("F_EXCEED_SIZE"===e&&this.options.fileSingleSizeLimit){var i=this.options.fileSingleSizeLimit/1024/1024+"M";alert("文件大小超过"+i+",不能上传")}if("Q_TYPE_DENIED"===e&&this.options.accept.length>0&&this.options.accept[0].extensions){var n=this.options.accept[0].extensions;alert("文件格式不是"+n+",不能上传")}"F_DUPLICATE"===e&&alert("不要重复上传"),console.log("validate error")})},_unRegister:function(){WebUploader.Uploader.unRegister("beforeSendFile"),WebUploader.Uploader.unRegister("beforeSend"),WebUploader.Uploader.unRegister("afterSendFile")},_register:function(i){n._unRegister();var o=null;WebUploader.Uploader.register({name:"beforeSendFile","before-send-file":function(i){var n=WebUploader.Deferred(),l=((new Date).getTime(),this.owner);return l.md5File(i.source).progress(function(e){i.larProgress.css("width",Math.floor(100*e)+"%").html("MD5  "+Math.floor(100*e)+"%")}).fail(function(){n.reject()}).then(function(r){e.ajax({type:"POST",url:FileUpdateUrl+"/sword/fileUpload/beforeSendFile",dataType:"json",autoWrap:!1,data:{md5:r,fileFullName:i.name,fileMiddleDir:l.options.fileMiddleDir,fileSize:i.size,isManage:l.options.isManage,isSearchFlag:!0},success:function(e){"noConfig"==e.model.status?(Util.alert("未找到附件配置，中断上传."),n.reject()):(i.larFileMd5=r,i.larFileId=e.model.data.id,i.larFilePath=e.model.data.filePath,"completed"===e.model.status?l.skipFile(i):o=e.model.data,n.resolve())}})}),n.promise()}}),WebUploader.Uploader.register({name:"beforeSend","before-send":function(i){var n=WebUploader.Deferred();return o.chunks?!function(){return e(o.chunks).each(function(e,n){if(n.chunk==i.chunk)return!0}),!1}()?n.resolve():n.reject():n.resolve(),n.promise()}}),WebUploader.Uploader.register({name:"afterSendFile","after-send-file":function(i){e.ajax({type:"POST",url:FileUpdateUrl+"/sword/fileUpload/afterSendFile",dataType:"json",autoWrap:!1,data:{id:i.larFileId},success:function(e){e.model.success}})}})}}})}});